/*
	liberis -- A set of libraries for controlling the NEC PC-FX

Copyright (C) 2011		Alex Marshall "trap15" <trap15@raidenii.net>

# This code is licensed to you under the terms of the MIT license;
# see file LICENSE or http://www.opensource.org/licenses/mit-license.php
*/

/*
 * Gameblabla :
 * This is similar to the other scsi dma example but uses 256 color mode instead.
 * Graphics data can be converted from a BMP file with my BMP2HUC tool.
 * https://github.com/gameblabla/bmp2huc
 * 
 * A C array for the color palette will also be exported for use in liberis.
*/

#include <eris/types.h>
#include <eris/std.h>
#include <eris/v810.h>
#include <eris/king.h>
#include <eris/tetsu.h>
#include <eris/romfont.h>
#include <eris/cd.h>
#include <eris/low/pad.h>
#include <eris/low/scsi.h>

#include "lbas.h"

#define ARRAY_SIZE(arr) (sizeof(arr) / sizeof((arr)[0]))

unsigned short pornpal[256] = {
	0x88,0x688,0x788,0xc88,0xe89,0xd88,0x1088,0x1088,
	0xf88,0x1288,0x1289,0x1188,0x1288,0x1278,0x1588,0x1788,
	0x1788,0x1788,0x1788,0x1888,0x1788,0x1888,0x1888,0x1788,
	0x1988,0x1b88,0x1c79,0x1978,0x1d88,0x1d78,0x1c88,0x1d88,
	0x1d88,0x1e88,0x1d88,0x1e88,0x1f88,0x1e88,0x1e88,0x1f88,
	0x2388,0x2488,0x2488,0x2488,0x2588,0x2589,0x2488,0x2488,
	0x2478,0x2588,0x2488,0x2578,0x2588,0x2588,0x2889,0x2979,
	0x2a98,0x2798,0x2988,0x2879,0x2a89,0x2a98,0x2b89,0x2888,
	0x2a79,0x2878,0x2888,0x2b79,0x2a78,0x2b89,0x2a88,0x2b88,
	0x2b88,0x2b88,0x2a88,0x2b88,0x2b88,0x2b88,0x2c88,0x2d88,
	0x2a86,0x3289,0x3179,0x3279,0x3289,0x3289,0x3278,0x3288,
	0x3288,0x3188,0x3288,0x3288,0x3288,0x2f77,0x3579,0x3388,
	0x3488,0x3589,0x3288,0x3488,0x3579,0x3689,0x3579,0x3689,
	0x3598,0x3588,0x3578,0x3678,0x3989,0x3889,0x3979,0x3888,
	0x3888,0x3988,0x3988,0x3888,0x3878,0x3f79,0x3f79,0x3f88,
	0x4088,0x4088,0x4088,0x4088,0x4088,0x4188,0x4088,0x4389,
	0x4479,0x4279,0x4a8a,0x4479,0x4278,0x4278,0x4488,0x4288,
	0x4288,0x4789,0x4697,0x4b7a,0x4679,0x4779,0x4788,0x4177,
	0x4788,0x4788,0x4788,0x4778,0x4ca7,0x4d79,0x507a,0x5079,
	0x4f88,0x4f88,0x4f89,0x4f88,0x4f78,0x5279,0x5179,0x5087,
	0x5188,0x5279,0x5178,0x5279,0x5388,0x5689,0x5688,0x5788,
	0x5c7a,0x617b,0x669b,0x5e88,0x6079,0x5f88,0x6079,0x6079,
	0x6079,0x6178,0x5f78,0x5c77,0x6088,0x63a7,0x657a,0x5d77,
	0x6589,0x5d77,0x667a,0x6588,0x6588,0x6597,0x6969,0x6d7a,
	0x6988,0x6f79,0x6f79,0x6f88,0x7079,0x6f88,0x6f79,0x6f88,
	0x7078,0x85ac,0x6b93,0x7d79,0x828a,0x7f79,0x7f88,0x7f79,
	0x8079,0x866b,0x8088,0x836a,0x7f95,0x8779,0x8788,0x8898,
	0x886a,0x9079,0x8f88,0x9188,0x9279,0x8b76,0x88a2,0x9b6b,
	0xa38b,0x9f88,0x9f87,0xa179,0xa36a,0xa379,0xa579,0xa369,
	0xa898,0xa797,0xac89,0xab69,0xb179,0xb188,0xb087,0xb288,
	0xc398,0xbf88,0xc169,0xc288,0xb1b0,0xc688,0xc459,0xc679,
	0xc679,0xc988,0xc366,0xcf88,0xe169,0xe978,0xf388,0xfa88,

};

int main(int argc, char *argv[])
{
	int i;
	u16 microprog[16];

	eris_king_init();
	eris_tetsu_init();
	
	eris_tetsu_set_priorities(0, 0, 1, 0, 0, 0, 0);
	eris_tetsu_set_king_palette(0, 1, 0, 0);
	eris_tetsu_set_rainbow_palette(0);

	eris_king_set_bg_prio(KING_BGPRIO_0, KING_BGPRIO_HIDE, KING_BGPRIO_HIDE, KING_BGPRIO_HIDE, 0);
	eris_king_set_bg_mode(KING_BGMODE_256_PAL, KING_BGPRIO_HIDE, KING_BGPRIO_HIDE, KING_BGPRIO_HIDE);
	eris_king_set_kram_pages(0, 0, 0, 0);

	for(i = 0; i < 16; i++) {
		microprog[i] = KING_CODE_NOP;
	}

	microprog[0] = KING_CODE_BG0_CG_0;
	microprog[1] = KING_CODE_BG0_CG_1;
	microprog[2] = KING_CODE_BG0_CG_2;
	microprog[3] = KING_CODE_BG0_CG_3;
	microprog[4] = KING_CODE_BG0_CG_4;
	microprog[5] = KING_CODE_BG1_CG_0;

	eris_king_disable_microprogram();
	eris_king_write_microprogram(microprog, 0, 16);
	eris_king_enable_microprogram();
	
	eris_tetsu_set_rainbow_palette(0);
	for(i = 0; i < ARRAY_SIZE(pornpal); i++) {
		eris_tetsu_set_palette(i, pornpal[i]);
	}
	
	eris_tetsu_set_video_mode(TETSU_LINES_262, 0, TETSU_DOTCLOCK_5MHz, TETSU_COLORS_16, TETSU_COLORS_16, 0, 0, 1, 0, 0, 0, 0);
	
	eris_king_set_bat_cg_addr(KING_BG0, 0, 0);
	eris_king_set_bat_cg_addr(KING_BG0SUB, 0, 0);
	eris_king_set_scroll(KING_BG0, 0, 0);
	eris_king_set_bg_size(KING_BG0, KING_BGSIZE_256, KING_BGSIZE_256, KING_BGSIZE_256, KING_BGSIZE_256);

	eris_king_set_kram_read(0, 1);
	eris_king_set_kram_write(0, 1);
	// Clear BG0's RAM
	for(i = 0x0; i < 0x7800 * 2; i++) {
		eris_king_kram_write(0);
	}
	eris_king_set_kram_write(0, 1);
	eris_cd_read_kram(BINARY_LBA_DUMB_BIN, 0x200, (0x18000 + 0x400));
	
	for(;;) {
	}

	return 0;
}
